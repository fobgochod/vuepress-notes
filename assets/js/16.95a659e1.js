(window.webpackJsonp=window.webpackJsonp||[]).push([[16],{607:function(s,t,a){s.exports=a.p+"assets/img/architect.be64a655.png"},608:function(s,t,a){s.exports=a.p+"assets/img/architect1.e2ac8a54.png"},697:function(s,t,a){"use strict";a.r(t);var n=a(13),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h1",{attrs:{id:"mysql调优-使用profiles-performance-schema性能监控"}},[s._v("mysql调优--使用profiles,performance_schema性能监控")]),s._v(" "),n("h2",{attrs:{id:"架构图"}},[s._v("架构图")]),s._v(" "),n("p",[n("img",{attrs:{src:a(607),alt:""}})]),s._v(" "),n("p",[n("img",{attrs:{src:a(608),alt:""}})]),s._v(" "),n("h4",{attrs:{id:"客户端-client"}},[s._v("客户端 Client")]),s._v(" "),n("h4",{attrs:{id:"服务端server"}},[s._v("服务端server")]),s._v(" "),n("ul",[n("li",[s._v("连接器\n"),n("ul",[n("li",[s._v("连接器负责跟客户端建立连接，获取权限、维持和管理连接\n"),n("ul",[n("li",[s._v("用户名密码验证")]),s._v(" "),n("li",[s._v("查询权限信息，分配对应的权限")]),s._v(" "),n("li",[s._v("可以使用show processlist查看现在的连接")]),s._v(" "),n("li",[s._v("如果太长时间没有动静，就会自动断开，通过wait_timeout控制，默认8小时")])])]),s._v(" "),n("li",[s._v("连接可以分为两类：\n"),n("ul",[n("li",[s._v("长连接：推荐使用，但是要周期性的断开长连接")]),s._v(" "),n("li",[s._v("短链接")])])])])]),s._v(" "),n("li",[s._v("查询缓存（MySQL版本8之前 有缓存）\n"),n("ul",[n("li",[s._v("当执行查询语句的时候，会先去查询缓存中查看结果，之前执行过的sql语句及其结果可能以key-value的形式存储在缓存中，如果能找到则直接返回，如果找不到，就继续执行后续的阶段。")]),s._v(" "),n("li",[s._v("但是，不推荐使用查询缓存：\n"),n("ul",[n("li",[s._v("查询缓存的失效比较频繁，只要表更新，缓存就会清空")]),s._v(" "),n("li",[s._v("缓存对应新更新的数据命中率比较低")])])])])]),s._v(" "),n("li",[s._v("分析器\n"),n("ul",[n("li",[s._v("AST(抽象语法树)")]),s._v(" "),n("li",[s._v("词法分析：Mysql需要把输入的字符串进行识别每个部分代表什么意思\n"),n("ul",[n("li",[s._v("把字符串 T 识别成 表名 T")]),s._v(" "),n("li",[s._v("把字符串 ID 识别成 列ID")])])]),s._v(" "),n("li",[s._v("语法分析：")]),s._v(" "),n("li",[s._v("根据语法规则判断这个sql语句是否满足mysql的语法，如果不符合就会报错“You have an error in your SQL syntax”")])])]),s._v(" "),n("li",[s._v("优化器\n"),n("ul",[n("li",[s._v("在具体执行SQL语句之前，要先经过优化器的处理\n"),n("ul",[n("li",[s._v("当表中有多个索引的时候，决定用哪个索引")]),s._v(" "),n("li",[s._v("当sql语句需要做多表关联的时候，决定表的连接顺序")]),s._v(" "),n("li",[s._v("等等")])])]),s._v(" "),n("li",[s._v("不同的执行方式对SQL语句的执行效率影响很大\n"),n("ul",{staticClass:"contains-task-list"},[n("li",[s._v("RBO: 基于规则的优化")]),s._v(" "),n("li",{staticClass:"task-list-item"},[n("input",{staticClass:"task-list-item-checkbox",attrs:{checked:"",disabled:"",type:"checkbox"}}),s._v(" CBO: 基于成本的优化")])])])])]),s._v(" "),n("li",[s._v("执行器")])]),s._v(" "),n("h4",{attrs:{id:"存储引擎"}},[s._v("存储引擎")]),s._v(" "),n("ul",[n("li",[s._v("IO\n"),n("ul",[n("li",[s._v("减少量")]),s._v(" "),n("li",[s._v("减少次数")])])])]),s._v(" "),n("h2",{attrs:{id:"profile"}},[s._v("PROFILE")]),s._v(" "),n("p",[s._v("profile参考：")]),s._v(" "),n("blockquote",[n("p",[s._v("页面底部 -> DOCUMENTATION -> MySQL Reference Manual -> SQL Statements -> Database Administration Statements -> SHOW Statements -> SHOW PROFILE Statement\n"),n("a",{attrs:{href:"https://dev.mysql.com/doc/refman/8.0/en/show-profile.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://dev.mysql.com/doc/refman/8.0/en/show-profile.html"),n("OutboundLink")],1)])]),s._v(" "),n("h3",{attrs:{id:"使用show-profile查询剖析工具"}},[s._v("使用show profile查询剖析工具")]),s._v(" "),n("div",{staticClass:"language-sql line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sql"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SHOW")]),s._v(" VARIABLES "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("LIKE")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'profiling'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" @"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@profiling")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 此工具默认是禁用的，可以通过服务器变量在会话级别动态的修改")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" profiling"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 当设置完成之后，在服务器上执行的所有语句，都会测量其耗费的时间和其他一些查询执行状态变更相关的数据。")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" emp"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 在mysql的命令行模式下只能显示两位小数的时间，可以使用如下命令查看具体的执行时间")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("show")]),s._v(" profiles"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 执行如下命令可以查看详细的每个步骤的时间：")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("show")]),s._v(" profile "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" query "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br")])]),n("h3",{attrs:{id:"type说明"}},[s._v("type说明")]),s._v(" "),n("ol",[n("li",[s._v("all：显示所有性能信息\n"),n("ul",[n("li",[s._v("show profile all for query n")])])]),s._v(" "),n("li",[s._v("block io：显示块io操作的次数\n"),n("ul",[n("li",[s._v("show  profile block io for query n")])])]),s._v(" "),n("li",[s._v("context switches：显示上下文切换次数，被动和主动\n"),n("ul",[n("li",[s._v("show profile context switches for query n")])])]),s._v(" "),n("li",[s._v("cpu：显示用户cpu时间、系统cpu时间\n"),n("ul",[n("li",[s._v("show profile cpu for query n")])])]),s._v(" "),n("li",[s._v("IPC：显示发送和接受的消息数量\n"),n("ul",[n("li",[s._v("show profile ipc for query n")])])]),s._v(" "),n("li",[s._v("Memory：暂未实现")]),s._v(" "),n("li",[s._v("page faults：显示页错误数量\n"),n("ul",[n("li",[s._v("show profile page faults for query n")])])]),s._v(" "),n("li",[s._v("source：显示源码中的函数名称与位置\n"),n("ul",[n("li",[s._v("show profile source for query n")])])]),s._v(" "),n("li",[s._v("swaps：显示swap的次数\n"),n("ul",[n("li",[s._v("show profile swaps for query n")])])])]),s._v(" "),n("h3",{attrs:{id:"通过performance-schema来查询profiling相关信息"}},[s._v("通过Performance Schema来查询profiling相关信息")]),s._v(" "),n("blockquote",[n("p",[s._v("参考："),n("a",{attrs:{href:"https://dev.mysql.com/doc/refman/5.7/en/performance-schema-query-profiling.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://dev.mysql.com/doc/refman/5.7/en/performance-schema-query-profiling.html"),n("OutboundLink")],1)])]),s._v(" "),n("div",{staticClass:"language-sql line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sql"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" performance_schema"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("setup_actors"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("UPDATE")]),s._v(" performance_schema"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("setup_actors "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SET")]),s._v(" ENABLED "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'NO'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" HISTORY "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'NO'")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" HOST "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'%'")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("AND")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("USER")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'%'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INSERT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INTO")]),s._v(" performance_schema"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("setup_actors "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("HOST"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("USER")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("ROLE"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("ENABLED"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("HISTORY"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("VALUES")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'localhost'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'test_user'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'%'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'YES'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'YES'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("UPDATE")]),s._v(" performance_schema"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("setup_instruments "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SET")]),s._v(" ENABLED "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'YES'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" TIMED "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'YES'")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" NAME "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("LIKE")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'%statement/%'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("UPDATE")]),s._v(" performance_schema"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("setup_instruments "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SET")]),s._v(" ENABLED "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'YES'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" TIMED "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'YES'")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" NAME "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("LIKE")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'%stage/%'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("UPDATE")]),s._v(" performance_schema"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("setup_consumers "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SET")]),s._v(" ENABLED "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'YES'")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" NAME "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("LIKE")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'%events_statements_%'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("UPDATE")]),s._v(" performance_schema"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("setup_consumers "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SET")]),s._v(" ENABLED "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'YES'")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" NAME "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("LIKE")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'%events_stages_%'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" scott"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("emp "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" empno "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("7900")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" EVENT_ID"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TRUNCATE")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("TIMER_WAIT"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000000000000")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("as")]),s._v(" Duration"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" SQL_TEXT "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" performance_schema"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("events_statements_history_long "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" SQL_TEXT "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("like")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'%empno = 7900%'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" event_name "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("AS")]),s._v(" Stage"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TRUNCATE")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("TIMER_WAIT"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000000000000")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("AS")]),s._v(" Duration "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" performance_schema"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("events_stages_history_long "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" NESTING_EVENT_ID"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("438808")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br")])]),n("h2",{attrs:{id:"performance-schema"}},[s._v("Performance Schema")]),s._v(" "),n("blockquote",[n("p",[s._v("页面底部 -> DOCUMENTATION -> MySQL Reference Manual -> MySQL Performance Schema\n"),n("a",{attrs:{href:"https://dev.mysql.com/doc/refman/8.0/en/performance-schema.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://dev.mysql.com/doc/refman/8.0/en/performance-schema.html"),n("OutboundLink")],1)])]),s._v(" "),n("h3",{attrs:{id:"_0、performance-schema的介绍"}},[s._v("0、performance_schema的介绍")]),s._v(" "),n("blockquote",[n("p",[s._v("MySQL的Performance Schema用于监控MySQL Server在一个较低级别的运行过程中的资源消耗、资源等待等情况。特点如下：")])]),s._v(" "),n("ol",[n("li",[s._v("提供了一种在数据库运行时实时检查server的内部执行情况的方法。performance_schema 数据库中的表使用performance_schema存储引擎。该数据库主要关注数据库运行过程中的性能相关的数据，与information_schema不同，information_schema主要关注server运行过程中的元数据")]),s._v(" "),n("li",[s._v("performance_schema通过监视server的事件来实现监视server内部运行情况， “事件”就是server内部活动中所做的任何事情以及对应的时间消耗，利用这些信息来判断server中的相关资源消耗在了哪里？一般来说，事件可以是函数调用、操作系统的等待、SQL语句执行的阶段（如sql语句执行过程中的parsing 或 sorting阶段）或者整个SQL语句与SQL语句集合。事件的采集可以方便的提供server中的相关存储引擎对磁盘文件、表I/O、表锁等资源的同步调用信息。")]),s._v(" "),n("li",[s._v("performance_schema中的事件与写入二进制日志中的事件（描述数据修改的events）、事件计划调度程序（这是一种存储程序）的事件不同。performance_schema中的事件记录的是server执行某些活动对某些资源的消耗、耗时、这些活动执行的次数等情况。")]),s._v(" "),n("li",[s._v("performance_schema中的事件只记录在本地server的performance_schema中，其下的这些表中数据发生变化时不会被写入binlog中，也不会通过复制机制被复制到其他server中。")]),s._v(" "),n("li",[s._v("当前活跃事件、历史事件和事件摘要相关的表中记录的信息。能提供某个事件的执行次数、使用时长。进而可用于分析某个特定线程、特定对象（如mutex或file）相关联的活动。")]),s._v(" "),n("li",[s._v("PERFORMANCE_SCHEMA存储引擎使用server源代码中的“检测点”来实现事件数据的收集。对于performance_schema实现机制本身的代码没有相关的单独线程来检测，这与其他功能（如复制或事件计划程序）不同")]),s._v(" "),n("li",[s._v("收集的事件数据存储在performance_schema数据库的表中。这些表可以使用SELECT语句查询，也可以使用SQL语句更新performance_schema数据库中的表记录（如动态修改performance_schema的setup_*开头的几个配置表，但要注意：配置表的更改会立即生效，这会影响数据收集）")]),s._v(" "),n("li",[s._v("performance_schema的表中的数据不会持久化存储在磁盘中，而是保存在内存中，一旦服务器重启，这些数据会丢失（包括配置表在内的整个performance_schema下的所有数据）")]),s._v(" "),n("li",[s._v("MySQL支持的所有平台中事件监控功能都可用，但不同平台中用于统计事件时间开销的计时器类型可能会有所差异。")])]),s._v(" "),n("h3",{attrs:{id:"_1、performance-schema入门"}},[s._v("1、performance schema入门")]),s._v(" "),n("blockquote",[n("p",[s._v("在mysql的5.7版本中，性能模式是默认开启的，如果想要显式的关闭的话需要修改配置文件，不能直接进行修改，会报错Variable 'performance_schema' is a read only variable。")])]),s._v(" "),n("div",{staticClass:"language-sql line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sql"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("--查看performance_schema的属性")]),s._v("\nmysql"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SHOW")]),s._v(" VARIABLES "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("LIKE")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'performance_schema'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("--------------------+-------+")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Variable_name      "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Value")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("--------------------+-------+")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" performance_schema "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ON")]),s._v("    "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("--------------------+-------+")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("row")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("in")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.01")]),s._v(" sec"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("--在配置文件中修改performance_schema的属性值，on表示开启，off表示关闭")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("mysqld"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nperformance_schema"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ON")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("--切换数据库")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("use")]),s._v(" performance_schema"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("--查看当前数据库下的所有表,会看到有很多表存储着相关的信息")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("show")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("tables")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("--可以通过show create table tablename来查看创建表的时候的表结构")]),s._v("\nmysql"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("show")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("create")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("table")]),s._v(" setup_consumers"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-----------------+---------------------------------")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Table")]),s._v("           "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Create")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Table")]),s._v("                    \n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-----------------+---------------------------------")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" setup_consumers "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CREATE")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TABLE")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("setup_consumers"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("NAME"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("varchar")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("NOT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("                      \n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("ENABLED"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("enum")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'YES'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'NO'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("NOT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),s._v("               \n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENGINE")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("PERFORMANCE_SCHEMA "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DEFAULT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CHARSET")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("utf8 "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("  \n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-----------------+---------------------------------")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("row")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("in")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v(" sec"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("                             \n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br")])]),n("p",[s._v("想要搞明白后续的内容，同学们需要理解两个基本概念：")]),s._v(" "),n("ul",[n("li",[s._v("instruments:生产者，用于采集mysql中各种各样的操作产生的事件信息，对应配置表中的配置项我们可以称为监控采集配置项。")]),s._v(" "),n("li",[s._v("consumers:消费者，对应的消费者表用于存储来自instruments采集的数据，对应配置表中的配置项我们可以称为消费存储配置项。")])]),s._v(" "),n("h3",{attrs:{id:"_2、performance-schema表的分类"}},[s._v("2、performance_schema表的分类")]),s._v(" "),n("blockquote",[n("p",[s._v("performance_schema库下的表可以按照监视不同的纬度就行分组。")])]),s._v(" "),n("div",{staticClass:"language-sql line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sql"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("--语句事件记录表，这些表记录了语句事件信息，当前语句事件表events_statements_current、历史语句事件表events_statements_history和长语句历史事件表events_statements_history_long、以及聚合后的摘要表summary，其中，summary表还可以根据帐号(account)，主机(host)，程序(program)，线程(thread)，用户(user)和全局(global)再进行细分)")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("show")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("tables")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("like")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'%statement%'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("--等待事件记录表，与语句事件类型的相关记录表类似：")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("show")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("tables")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("like")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'%wait%'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("--阶段事件记录表，记录语句执行的阶段事件的表")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("show")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("tables")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("like")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'%stage%'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("--事务事件记录表，记录事务相关的事件的表")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("show")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("tables")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("like")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'%transaction%'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("--监控文件系统层调用的表")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("show")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("tables")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("like")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'%file%'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("--监视内存使用的表")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("show")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("tables")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("like")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'%memory%'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("--动态对performance_schema进行配置的配置表")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("show")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("tables")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("like")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'%setup%'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br")])]),n("h3",{attrs:{id:"_3、performance-schema的简单配置与使用"}},[s._v("3、performance_schema的简单配置与使用")]),s._v(" "),n("blockquote",[n("p",[s._v("数据库刚刚初始化并启动时，并非所有instruments(事件采集项，在采集项的配置表中每一项都有一个开关字段，或为YES，或为NO)和consumers(与采集项类似，也有一个对应的事件类型保存表配置项，为YES就表示对应的表保存性能数据，为NO就表示对应的表不保存性能数据)都启用了，所以默认不会收集所有的事件，可能你需要检测的事件并没有打开，需要进行设置，可以使用如下两个语句打开对应的instruments和consumers（行计数可能会因MySQL版本而异)。")])]),s._v(" "),n("div",{staticClass:"language-sql line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sql"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("--打开等待事件的采集器配置项开关，需要修改setup_instruments配置表中对应的采集器配置项")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("UPDATE")]),s._v(" setup_instruments "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SET")]),s._v(" ENABLED "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'YES'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" TIMED "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'YES'")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" name "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("like")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'wait%'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("--打开等待事件的保存表配置开关，修改setup_consumers配置表中对应的配置项")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("UPDATE")]),s._v(" setup_consumers "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SET")]),s._v(" ENABLED "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'YES'")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" name "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("like")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'%wait%'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("--当配置完成之后可以查看当前server正在做什么，可以通过查询events_waits_current表来得知，该表中每个线程只包含一行数据，用于显示每个线程的最新监视事件")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" events_waits_current\\G\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("row")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("\n            THREAD_ID: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v("\n             EVENT_ID: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("570")]),s._v("\n         END_EVENT_ID: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("570")]),s._v("\n           EVENT_NAME: wait"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("synch"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("mutex"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("innodb")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("buf_dblwr_mutex\n               SOURCE: \n          TIMER_START: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4508505105239280")]),s._v("\n            TIMER_END: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4508505105270160")]),s._v("\n           TIMER_WAIT: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("30880")]),s._v("\n                SPINS: "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),s._v("\n        OBJECT_SCHEMA: "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),s._v("\n          OBJECT_NAME: "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),s._v("\n           INDEX_NAME: "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),s._v("\n          OBJECT_TYPE: "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),s._v("\nOBJECT_INSTANCE_BEGIN: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("67918392")]),s._v("\n     NESTING_EVENT_ID: "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),s._v("\n   NESTING_EVENT_TYPE: "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),s._v("\n            OPERATION: "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("lock")]),s._v("\n      NUMBER_OF_BYTES: "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),s._v("\n                FLAGS: "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/*该信息表示线程id为11的线程正在等待buf_dblwr_mutex锁，等待事件为30880\n属性说明：\n\tid:事件来自哪个线程，事件编号是多少\n\tevent_name:表示检测到的具体的内容\n\tsource:表示这个检测代码在哪个源文件中以及行号\n\ttimer_start:表示该事件的开始时间\n\ttimer_end:表示该事件的结束时间\n\ttimer_wait:表示该事件总的花费时间\n注意：_current表中每个线程只保留一条记录，一旦线程完成工作，该表中不会再记录该线程的事件信息\n*/")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/*\n_history表中记录每个线程应该执行完成的事件信息，但每个线程的事件信息只会记录10条，再多就会被覆盖，*_history_long表中记录所有线程的事件信息，但总记录数量是10000，超过就会被覆盖掉\n*/")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" thread_id"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("event_id"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("event_name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("timer_wait "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" events_waits_history "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("order")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("by")]),s._v(" thread_id "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("limit")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("21")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/*\nsummary表提供所有事件的汇总信息，该组中的表以不同的方式汇总事件数据（如：按用户，按主机，按线程等等）。例如：要查看哪些instruments占用最多的时间，可以通过对events_waits_summary_global_by_event_name表的COUNT_STAR或SUM_TIMER_WAIT列进行查询（这两列是对事件的记录数执行COUNT（*）、事件记录的TIMER_WAIT列执行SUM（TIMER_WAIT）统计而来）\n*/")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" EVENT_NAME"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("COUNT_STAR "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" events_waits_summary_global_by_event_name  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ORDER")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BY")]),s._v(" COUNT_STAR "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DESC")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("LIMIT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/*\ninstance表记录了哪些类型的对象会被检测。这些对象在被server使用时，在该表中将会产生一条事件记录，例如，file_instances表列出了文件I/O操作及其关联文件名\n*/")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" file_instances "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("limit")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br")])]),n("h3",{attrs:{id:"_4、常用配置项的参数说明"}},[s._v("4、常用配置项的参数说明")]),s._v(" "),n("p",[s._v("1、启动选项")]),s._v(" "),n("blockquote",[n("p",[s._v("注意，这些启动选项要生效的前提是，需要设置performance_schema=ON。另外，这些启动选项虽然无法使用show variables语句查看，但我们可以通过setup_instruments和setup_consumers表查询这些选项指定的值。")])]),s._v(" "),n("div",{staticClass:"language-sql line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sql"}},[n("code",[s._v("performance_schema_consumer_events_statements_current"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("TRUE")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("--是否在mysql server启动时就开启events_statements_current表的记录功能(该表记录当前的语句事件信息)，启动之后也可以在setup_consumers表中使用UPDATE语句进行动态更新setup_consumers配置表中的events_statements_current配置项，默认值为TRUE")]),s._v("\n\nperformance_schema_consumer_events_statements_history"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("TRUE")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("--与performance_schema_consumer_events_statements_current选项类似，但该选项是用于配置是否记录语句事件短历史信息，默认为TRUE")]),s._v("\n\nperformance_schema_consumer_events_stages_history_long"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("FALSE")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("--与performance_schema_consumer_events_statements_current选项类似，但该选项是用于配置是否记录语句事件长历史信息，默认为FALSE")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("--除了statement(语句)事件之外，还支持：wait(等待)事件、state(阶段)事件、transaction(事务)事件，他们与statement事件一样都有三个启动项分别进行配置，但这些等待事件默认未启用，如果需要在MySQL Server启动时一同启动，则通常需要写进my.cnf配置文件中")]),s._v("\nperformance_schema_consumer_global_instrumentation"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("TRUE")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("--是否在MySQL Server启动时就开启全局表（如：mutex_instances、rwlock_instances、cond_instances、file_instances、users、hostsaccounts、socket_summary_by_event_name、file_summary_by_instance等大部分的全局对象计数统计和事件汇总统计信息表 ）的记录功能，启动之后也可以在setup_consumers表中使用UPDATE语句进行动态更新全局配置项")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("--默认值为TRUE")]),s._v("\n\nperformance_schema_consumer_statements_digest"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("TRUE")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("--是否在MySQL Server启动时就开启events_statements_summary_by_digest 表的记录功能，启动之后也可以在setup_consumers表中使用UPDATE语句进行动态更新digest配置项")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("--默认值为TRUE")]),s._v("\n\nperformance_schema_consumer_thread_instrumentation"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("TRUE")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("--是否在MySQL Server启动时就开启")]),s._v("\n\nevents_xxx_summary_by_yyy_by_event_name表的记录功能，启动之后也可以在setup_consumers表中使用"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("UPDATE")]),s._v("语句进行动态更新线程配置项\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("--默认值为TRUE")]),s._v("\n\nperformance_schema_instrument"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("--是否在MySQL Server启动时就启用某些采集器，由于instruments配置项多达数千个，所以该配置项支持key-value模式，还支持%号进行通配等，如下:")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("--[=name]可以指定为具体的Instruments名称（但是这样如果有多个需要指定的时候，就需要使用该选项多次），也可以使用通配符，可以指定instruments相同的前缀+通配符，也可以使用%代表所有的instruments")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("--指定开启单个instruments")]),s._v("\n\nperformance"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("schema")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("instrument"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'instrument_name=value'")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("--使用通配符指定开启多个instruments")]),s._v("\n\nperformance"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("schema")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("instrument"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'wait/synch/cond/%=COUNTED'")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("--开关所有的instruments")]),s._v("\n\nperformance"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("schema")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("instrument"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'%=ON'")]),s._v("\n\nperformance"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("schema")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("instrument"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'%=OFF'")]),s._v("\n\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br")])]),n("p",[s._v("2、系统变量")]),s._v(" "),n("div",{staticClass:"language-sql line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sql"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("show")]),s._v(" variables "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("like")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'%performance_schema%'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("--重要的属性解释")]),s._v("\nperformance_schema"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ON")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/*\n控制performance_schema功能的开关，要使用MySQL的performance_schema，需要在mysqld启动时启用，以启用事件收集功能\n该参数在5.7.x之前支持performance_schema的版本中默认关闭，5.7.x版本开始默认开启\n注意：如果mysqld在初始化performance_schema时发现无法分配任何相关的内部缓冲区，则performance_schema将自动禁用，并将performance_schema设置为OFF\n*/")]),s._v("\n\nperformance_schema_digests_size"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10000")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/*\n控制events_statements_summary_by_digest表中的最大行数。如果产生的语句摘要信息超过此最大值，便无法继续存入该表，此时performance_schema会增加状态变量\n*/")]),s._v("\nperformance_schema_events_statements_history_long_size"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10000")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/*\n控制events_statements_history_long表中的最大行数，该参数控制所有会话在events_statements_history_long表中能够存放的总事件记录数，超过这个限制之后，最早的记录将被覆盖\n全局变量，只读变量，整型值，5.6.3版本引入 * 5.6.x版本中，5.6.5及其之前的版本默认为10000，5.6.6及其之后的版本默认值为-1，通常情况下，自动计算的值都是10000 * 5.7.x版本中，默认值为-1，通常情况下，自动计算的值都是10000\n*/")]),s._v("\nperformance_schema_events_statements_history_size"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/*\n控制events_statements_history表中单个线程（会话）的最大行数，该参数控制单个会话在events_statements_history表中能够存放的事件记录数，超过这个限制之后，单个会话最早的记录将被覆盖\n全局变量，只读变量，整型值，5.6.3版本引入 * 5.6.x版本中，5.6.5及其之前的版本默认为10，5.6.6及其之后的版本默认值为-1，通常情况下，自动计算的值都是10 * 5.7.x版本中，默认值为-1，通常情况下，自动计算的值都是10\n除了statement(语句)事件之外，wait(等待)事件、state(阶段)事件、transaction(事务)事件，他们与statement事件一样都有三个参数分别进行存储限制配置，有兴趣的同学自行研究，这里不再赘述\n*/")]),s._v("\nperformance_schema_max_digest_length"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1024")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/*\n用于控制标准化形式的SQL语句文本在存入performance_schema时的限制长度，该变量与max_digest_length变量相关(max_digest_length变量含义请自行查阅相关资料)\n全局变量，只读变量，默认值1024字节，整型值，取值范围0~1048576\n*/")]),s._v("\nperformance_schema_max_sql_text_length"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1024")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/*\n控制存入events_statements_current，events_statements_history和events_statements_history_long语句事件表中的SQL_TEXT列的最大SQL长度字节数。 超出系统变量performance_schema_max_sql_text_length的部分将被丢弃，不会记录，一般情况下不需要调整该参数，除非被截断的部分与其他SQL比起来有很大差异\n全局变量，只读变量，整型值，默认值为1024字节，取值范围为0~1048576，5.7.6版本引入\n降低系统变量performance_schema_max_sql_text_length值可以减少内存使用，但如果汇总的SQL中，被截断部分有较大差异，会导致没有办法再对这些有较大差异的SQL进行区分。 增加该系统变量值会增加内存使用，但对于汇总SQL来讲可以更精准地区分不同的部分。\n*/")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br")])]),n("h3",{attrs:{id:"_5、重要配置表的相关说明"}},[s._v("5、重要配置表的相关说明")]),s._v(" "),n("blockquote",[n("p",[s._v("配置表之间存在相互关联关系，按照配置影响的先后顺序，可添加为")])]),s._v(" "),n("p",[n("img",{attrs:{src:"C:%5CUsers%5C63198%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20191203125003597.png",alt:"image-20191203125003597"}})]),s._v(" "),n("div",{staticClass:"language-sql line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sql"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/*\nperformance_timers表中记录了server中有哪些可用的事件计时器\n字段解释：\n\ttimer_name:表示可用计时器名称，CYCLE是基于CPU周期计数器的定时器\n\ttimer_frequency:表示每秒钟对应的计时器单位的数量,CYCLE计时器的换算值与CPU的频率相关、\n\ttimer_resolution:计时器精度值，表示在每个计时器被调用时额外增加的值\n\ttimer_overhead:表示在使用定时器获取事件时开销的最小周期值\n*/")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" performance_timers"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/*\nsetup_timers表中记录当前使用的事件计时器信息\n字段解释：\n\tname:计时器类型，对应某个事件类别\n\ttimer_name:计时器类型名称\n*/")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" setup_timers"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/*\nsetup_consumers表中列出了consumers可配置列表项\n字段解释：\n\tNAME：consumers配置名称\n\tENABLED：consumers是否启用，有效值为YES或NO，此列可以使用UPDATE语句修改。\n*/")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" setup_consumers"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/*\nsetup_instruments 表列出了instruments 列表配置项，即代表了哪些事件支持被收集：\n字段解释：\n\tNAME：instruments名称，instruments名称可能具有多个部分并形成层次结构\n\tENABLED：instrumetns是否启用，有效值为YES或NO，此列可以使用UPDATE语句修改。如果设置为NO，则这个instruments不会被执行，不会产生任何的事件信息\n\tTIMED：instruments是否收集时间信息，有效值为YES或NO，此列可以使用UPDATE语句修改，如果设置为NO，则这个instruments不会收集时间信息\n*/")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" setup_instruments"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/*\nsetup_actors表的初始内容是匹配任何用户和主机，因此对于所有前台线程，默认情况下启用监视和历史事件收集功能\n字段解释：\n\tHOST：与grant语句类似的主机名，一个具体的字符串名字，或使用“％”表示“任何主机”\n\tUSER：一个具体的字符串名称，或使用“％”表示“任何用户”\n\tROLE：当前未使用，MySQL 8.0中才启用角色功能\n\tENABLED：是否启用与HOST，USER，ROLE匹配的前台线程的监控功能，有效值为：YES或NO\n\tHISTORY：是否启用与HOST， USER，ROLE匹配的前台线程的历史事件记录功能，有效值为：YES或NO\n*/")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" setup_actors"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/*\nsetup_objects表控制performance_schema是否监视特定对象。默认情况下，此表的最大行数为100行。\n字段解释：\n\tOBJECT_TYPE：instruments类型，有效值为：“EVENT”（事件调度器事件）、“FUNCTION”（存储函数）、“PROCEDURE”（存储过程）、“TABLE”（基表）、“TRIGGER”（触发器），TABLE对象类型的配置会影响表I/O事件（wait/io/table/sql/handler instrument）和表锁事件（wait/lock/table/sql/handler instrument）的收集\n\tOBJECT_SCHEMA：某个监视类型对象涵盖的数据库名称，一个字符串名称，或“％”(表示“任何数据库”)\n\tOBJECT_NAME：某个监视类型对象涵盖的表名，一个字符串名称，或“％”(表示“任何数据库内的对象”)\n\tENABLED：是否开启对某个类型对象的监视功能，有效值为：YES或NO。此列可以修改\n\tTIMED：是否开启对某个类型对象的时间收集功能，有效值为：YES或NO，此列可以修改\n*/")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" setup_objects"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/*\nthreads表对于每个server线程生成一行包含线程相关的信息，\n字段解释：\n\tTHREAD_ID：线程的唯一标识符（ID）\n\tNAME：与server中的线程检测代码相关联的名称(注意，这里不是instruments名称)\n\tTYPE：线程类型，有效值为：FOREGROUND、BACKGROUND。分别表示前台线程和后台线程\n\tPROCESSLIST_ID：对应INFORMATION_SCHEMA.PROCESSLIST表中的ID列。\n\tPROCESSLIST_USER：与前台线程相关联的用户名，对于后台线程为NULL。\n\tPROCESSLIST_HOST：与前台线程关联的客户端的主机名，对于后台线程为NULL。\n\tPROCESSLIST_DB：线程的默认数据库，如果没有，则为NULL。\n\tPROCESSLIST_COMMAND：对于前台线程，该值代表着当前客户端正在执行的command类型，如果是sleep则表示当前会话处于空闲状态\n\tPROCESSLIST_TIME：当前线程已处于当前线程状态的持续时间（秒）\n\tPROCESSLIST_STATE：表示线程正在做什么事情。\n\tPROCESSLIST_INFO：线程正在执行的语句，如果没有执行任何语句，则为NULL。\n\tPARENT_THREAD_ID：如果这个线程是一个子线程（由另一个线程生成），那么该字段显示其父线程ID\n\tROLE：暂未使用\n\tINSTRUMENTED：线程执行的事件是否被检测。有效值：YES、NO \n\tHISTORY：是否记录线程的历史事件。有效值：YES、NO * \n\tTHREAD_OS_ID：由操作系统层定义的线程或任务标识符（ID）：\n*/")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" threads\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br"),n("span",{staticClass:"line-number"},[s._v("56")]),n("br"),n("span",{staticClass:"line-number"},[s._v("57")]),n("br"),n("span",{staticClass:"line-number"},[s._v("58")]),n("br"),n("span",{staticClass:"line-number"},[s._v("59")]),n("br"),n("span",{staticClass:"line-number"},[s._v("60")]),n("br"),n("span",{staticClass:"line-number"},[s._v("61")]),n("br"),n("span",{staticClass:"line-number"},[s._v("62")]),n("br"),n("span",{staticClass:"line-number"},[s._v("63")]),n("br"),n("span",{staticClass:"line-number"},[s._v("64")]),n("br"),n("span",{staticClass:"line-number"},[s._v("65")]),n("br"),n("span",{staticClass:"line-number"},[s._v("66")]),n("br"),n("span",{staticClass:"line-number"},[s._v("67")]),n("br"),n("span",{staticClass:"line-number"},[s._v("68")]),n("br"),n("span",{staticClass:"line-number"},[s._v("69")]),n("br"),n("span",{staticClass:"line-number"},[s._v("70")]),n("br"),n("span",{staticClass:"line-number"},[s._v("71")]),n("br"),n("span",{staticClass:"line-number"},[s._v("72")]),n("br"),n("span",{staticClass:"line-number"},[s._v("73")]),n("br"),n("span",{staticClass:"line-number"},[s._v("74")]),n("br"),n("span",{staticClass:"line-number"},[s._v("75")]),n("br"),n("span",{staticClass:"line-number"},[s._v("76")]),n("br"),n("span",{staticClass:"line-number"},[s._v("77")]),n("br"),n("span",{staticClass:"line-number"},[s._v("78")]),n("br")])]),n("blockquote",[n("p",[s._v("注意：在performance_schema库中还包含了很多其他的库和表，能对数据库的性能做完整的监控，大家需要参考官网详细了解。")])]),s._v(" "),n("h3",{attrs:{id:"_6、performance-schema实践操作"}},[s._v("6、performance_schema实践操作")]),s._v(" "),n("blockquote",[n("p",[s._v("基本了解了表的相关信息之后，可以通过这些表进行实际的查询操作来进行实际的分析。")])]),s._v(" "),n("div",{staticClass:"language-sql line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sql"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("--1、哪类的SQL执行最多？")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" DIGEST_TEXT"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("COUNT_STAR"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("FIRST_SEEN"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("LAST_SEEN "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" events_statements_summary_by_digest "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ORDER")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BY")]),s._v(" COUNT_STAR "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DESC")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("--2、哪类SQL的平均响应时间最多？")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" DIGEST_TEXT"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("AVG_TIMER_WAIT "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" events_statements_summary_by_digest "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ORDER")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BY")]),s._v(" COUNT_STAR "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DESC")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("--3、哪类SQL排序记录数最多？")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" DIGEST_TEXT"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("SUM_SORT_ROWS "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" events_statements_summary_by_digest "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ORDER")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BY")]),s._v(" COUNT_STAR "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DESC")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("--4、哪类SQL扫描记录数最多？")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" DIGEST_TEXT"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("SUM_ROWS_EXAMINED "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" events_statements_summary_by_digest "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ORDER")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BY")]),s._v(" COUNT_STAR "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DESC")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("--5、哪类SQL使用临时表最多？")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" DIGEST_TEXT"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("SUM_CREATED_TMP_TABLES"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("SUM_CREATED_TMP_DISK_TABLES "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" events_statements_summary_by_digest "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ORDER")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BY")]),s._v(" COUNT_STAR "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DESC")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("--6、哪类SQL返回结果集最多？")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" DIGEST_TEXT"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("SUM_ROWS_SENT "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" events_statements_summary_by_digest "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ORDER")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BY")]),s._v(" COUNT_STAR "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DESC")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("--7、哪个表物理IO最多？")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" file_name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("event_name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("SUM_NUMBER_OF_BYTES_READ"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("SUM_NUMBER_OF_BYTES_WRITE "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" file_summary_by_instance "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ORDER")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BY")]),s._v(" SUM_NUMBER_OF_BYTES_READ "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" SUM_NUMBER_OF_BYTES_WRITE "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DESC")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("--8、哪个表逻辑IO最多？")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" object_name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("COUNT_READ"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("COUNT_WRITE"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("COUNT_FETCH"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("SUM_TIMER_WAIT "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" table_io_waits_summary_by_table "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ORDER")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BY")]),s._v(" sum_timer_wait "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DESC")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("--9、哪个索引访问最多？")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" OBJECT_NAME"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("INDEX_NAME"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("COUNT_FETCH"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("COUNT_INSERT"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("COUNT_UPDATE"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("COUNT_DELETE "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" table_io_waits_summary_by_index_usage "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ORDER")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BY")]),s._v(" SUM_TIMER_WAIT "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DESC")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("--10、哪个索引从来没有用过？")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" OBJECT_SCHEMA"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("OBJECT_NAME"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("INDEX_NAME "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" table_io_waits_summary_by_index_usage "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" INDEX_NAME "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("IS")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("NOT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("AND")]),s._v(" COUNT_STAR "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("AND")]),s._v(" OBJECT_SCHEMA "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<>")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'mysql'")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ORDER")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BY")]),s._v(" OBJECT_SCHEMA"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("OBJECT_NAME"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("--11、哪个等待事件消耗时间最多？")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" EVENT_NAME"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("COUNT_STAR"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("SUM_TIMER_WAIT"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("AVG_TIMER_WAIT "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" events_waits_summary_global_by_event_name "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" event_name "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'idle'")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ORDER")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BY")]),s._v(" SUM_TIMER_WAIT "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DESC")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("--12-1、剖析某条SQL的执行情况，包括statement信息，stege信息，wait信息")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" EVENT_ID"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("sql_text "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" events_statements_history "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" sql_text "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("LIKE")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'%count(*)%'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("--12-2、查看每个阶段的时间消耗")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" event_id"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("EVENT_NAME"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("SOURCE"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("TIMER_END "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" TIMER_START "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" events_stages_history_long "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" NESTING_EVENT_ID "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1553")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("--12-3、查看每个阶段的锁等待情况")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" event_id"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("event_name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("source"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("timer_wait"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("object_name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("index_name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("operation"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("nesting_event_id "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" events_waits_history_longWHERE nesting_event_id "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1553")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br")])]),n("h2",{attrs:{id:"processlist"}},[s._v("processlist")]),s._v(" "),n("blockquote",[n("p",[s._v("页面底部 -> DOCUMENTATION -> MySQL Reference Manual -> SQL Statements -> Database Administration Statements -> SHOW Statements -> SHOW PROCESSLIST Statement\n"),n("a",{attrs:{href:"https://dev.mysql.com/doc/refman/8.0/en/show-processlist.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://dev.mysql.com/doc/refman/8.0/en/show-processlist.html"),n("OutboundLink")],1)])]),s._v(" "),n("p",[s._v("使用show processlist查看连接的线程个数，来观察是否有大量线程处于不正常的状态或者其他不正常的特征")]),s._v(" "),n("h4",{attrs:{id:"属性说明"}},[s._v("属性说明")]),s._v(" "),n("ul",[n("li",[s._v("id表示session id")]),s._v(" "),n("li",[s._v("user表示操作的用户")]),s._v(" "),n("li",[s._v("host表示操作的主机")]),s._v(" "),n("li",[s._v("db表示操作的数据库")]),s._v(" "),n("li",[s._v("command表示当前状态\n"),n("ul",[n("li",[s._v("sleep：线程正在等待客户端发送新的请求")]),s._v(" "),n("li",[s._v("query：线程正在执行查询或正在将结果发送给客户端")]),s._v(" "),n("li",[s._v("locked：在mysql的服务层，该线程正在等待表锁")]),s._v(" "),n("li",[s._v("analyzing and statistics：线程正在收集存储引擎的统计信息，并生成查询的执行计划")]),s._v(" "),n("li",[s._v("Copying to tmp table：线程正在执行查询，并且将其结果集都复制到一个临时表中")]),s._v(" "),n("li",[s._v("sorting result：线程正在对结果集进行排序")]),s._v(" "),n("li",[s._v("sending data：线程可能在多个状态之间传送数据，或者在生成结果集或者向客户端返回数据")])])]),s._v(" "),n("li",[s._v("info表示详细的sql语句")]),s._v(" "),n("li",[s._v("time表示相应命令执行时间")]),s._v(" "),n("li",[s._v("state表示命令执行状态")])])])}),[],!1,null,null,null);t.default=e.exports}}]);